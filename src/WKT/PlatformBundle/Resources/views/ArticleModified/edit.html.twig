{# src/WKT/PlatformBundle/Resources/views/ArticleModified/edit.html.twig #}

{% extends 'WKTPlatformBundle:ArticleModified:articleModifiedLayout.html.twig' %}
{% block introListArticleModified %}
    Choisissez la version sur laquelle vous pr√©ferez travailler :
{% endblock %}
{% block urlArticleModified %}
	{{ path('wkt_platform_article_modified_edit', {'id': articleModified.id}) }}
{% endblock %}
{% block articleModified %}
	<div class="panel panel-default">
	  <div class="panel-heading">
	    <h3 class="panel-title">Enrichissez une modification existante</h3>
	  </div>
	</div>
	{{ parent() }}
    <div class="well">
		{{ form_start(form, {'attr': {'class': 'form-horizontal'}}) }}
	    <div class="form-group">
	    	{{ form_label(form.title, "Titre de l'article", {'label_attr': {'class': 'col-sm-2 control-label'}}) }}
	        {{ form_errors(form.title) }}
	        <div class="col-sm-10">
	        	{{ form_widget(form.title, {'attr': {'class': 'form-control'}, 'value': articleModified.title}) }}
	        </div>
	    </div>
	    <div class="form-group">
	        {{ form_label(form.introduction, "Introduction de l'article", {'label_attr': {'class': 'col-sm-2 control-label'}}) }}
	        {{ form_errors(form.introduction) }}
	        <div class="col-sm-10">
	        	{{ form_widget(form.introduction, {'attr': {'class': 'form-control'}, 'value': articleModified.introduction }) }}
	        </div>
	    </div>
	    <div class="form-group">
	        {{ form_label(form.content, "Contenu de l'article", {'label_attr': {'class': 'col-sm-2 control-label'}}) }}
	        {{ form_errors(form.content) }}
	        <div class="col-sm-10">
	        	{{ form_widget(form.content, {'attr': {'class': 'form-control'}, 'value': articleModified.content}) }}
	        </div>
	    </div>
	    <div class="form-group">
	    	{% if articleModified.video is empty %}
	        	{{ form_label(form.video, "Video de l'article : Aucune vid√©o n'est encore enregistr√©e sur cette article", {'label_attr': {'class': 'col-sm-7 control-label'}}) }}
	        {% else %}
	            {{ form_label(form.video, "Video de l'article :", {'label_attr': {'class': 'col-sm-2 control-label'}}) }}
	        <div class="col-sm-10">
			    <div class="embed-responsive embed-responsive-16by9">
			    	<iframe class="embed-responsive-item" allowfullscreen src="https://www.youtube.com/embed/{{ articleModified.video.url}}"></iframe>
			    </div>
	        </div>
	        {% endif %}
	    </div>
	    <div style="display: none;" id="alertVideo" class="alert alert-danger">
	    	<p class="text-center">Merci d'ajouter une url valide et un nom d'auteur pour chaque vid√©o</p>
	    </div>
	    <div class="form-group">
	        {{ form_label(form.video.url, "Url de la video", {'label_attr': {'class': 'col-sm-2 col-sm-offset-1 control-label'}}) }}
	        {{ form_errors(form.video.url) }}
	        <div class="col-sm-9">
	        	{{ form_errors(form.video.url) }}
	        	{% if articleModified.video is empty %}
					{{ form_widget(form.video.url, {'attr': {'class': 'form-control'}}) }}
				{% else %}
				    {{ form_widget(form.video.url, {'attr': {'class': 'form-control'}, 'value': 'https://www.youtube.com/embed/' ~ articleModified.video.url }) }}
	        	{% endif %}
	        </div> 
	    </div>
	    <div class="form-group">
	        {{ form_label(form.video.author, "Auteur de la video", {'label_attr': {'class': 'col-sm-2 col-sm-offset-1 control-label'}}) }}
	        {{ form_errors(form.video.author) }}
	        <div class="col-sm-9">
			{{ form_errors(form.video.author) }}
			{% if articleModified.video is empty %}
				{{ form_widget(form.video.author, {'attr': {'class': 'form-control'}}) }}
				{% else %}
			    	{{ form_widget(form.video.author, {'attr': {'class': 'form-control'}, 'value': articleModified.video.author}) }}
			{% endif %}
	        </div>
	    </div>
	      <!-- Modal -->
	    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	        <div class="modal-dialog modal-sm" role="document">
	        	<div class="modal-content">
		            <div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title text-center" id="myModalLabel">Merci</h4>
						<p class="text-center">Pour votre contribution</p>
		            </div>
		            <div class="modal-body">
						<p class="text-center">Une derni√®re chose pour nous aider. D√Ætes nous ce que vous avez fait :</p>
						<div class="form-group">
							{{ form_errors(form.typeOfModification) }}
							<div class="col-sm-12">
								{{ form_widget(form.typeOfModification) }}
							</div>
						</div>
						<div class="form-group">
							{{ form_errors(form.commit) }}
							<div class="col-sm-12">
								{{ form_widget(form.commit, {'value': '', 'attr': {'class': 'form-control', 'placeholder': "Expliquez nous plus en d√©tail. Ce n'est pas obligatoire mais c'est cool pour la communaut√© ! üòÅ"}}) }}
							</div>
						</div>
		            </div>
		            <div class="modal-footer">
		              {{ form_widget(form.save, { 'label': 'Valider', 'attr': {'class': ' col-xs-12 btn btn-success'}}) }}
		        	</div>
	        	</div>
	    	</div>
	    </div>
	    <div class="row">
			<a id="buttonForModal" type="button" class="col-xs-2 col-xs-offset-1 btn btn-success" data-toggle="modal" data-target="#myModal">
			  Valider</a>
	    	<a class="col-xs-2 col-xs-offset-2 btn btn-danger" href="{{ path('wkt_platform_article_modified_view', {'id': articleModified.id}) }}">Voir modification</a>
	    	<a class="col-xs-2 col-xs-offset-2 btn btn-primary" href="{{ path('wkt_platform_article_view', {'id': articleModified.article.id, 'slugTraining': articleModified.article.part.training.slug, 'slugArticle': articleModified.article.slug }) }}">Article principal</a>
	    </div>
    	

    
		{# G√©n√©ration automatique des champs pas encore √©crits.
		 Dans cet exemple, ce serait le champ CSRF (g√©r√© automatiquement par Symfony !)
		 et tous les champs cach√©s (type ¬´ hidden ¬ª). #}
		{{ form_rest(form) }}

		{# Fermeture de la balise <form> du formulaire HTML #}
		{{ form_end(form) }}
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script>
		$( document ).ready(function() {
			$alertVideo = $('#alertVideo');
			$url = $('#wkt_platformbundle_articlemodified_video_url');
			$author = $('#wkt_platformbundle_articlemodified_video_author');
			$buttonForModal = $('#buttonForModal');

			//fonction qui va permettre de verifier avant l'ouverture de la modale
			//si le champ video a √©t√© ignor√© ou rempli correctement
			//sinon on emp√™che lo'uverture de la modale et on affiche une erreur
			$('#myModal').on('show.bs.modal', function (e) {
				$alertVideo.hide();
		  		if ($author.val() == '' && $url.val() == '') {
		  			return;
		  		}else if (!($author.val() == '') && $url.val() == '') {
		  			$alertVideo.show();
		  			return e.preventDefault(); // stops modal from being shown
		  		}else if ($author.val() == '' && !($url.val() == '')) {
		  			$alertVideo.show();
		  			return e.preventDefault(); // stops modal from being shown
		  		}  
			})
		})
	</script>
{% endblock %}
{% block submitButton %}
	<!-- Button trigger modal -->
	
{% endblock %}

